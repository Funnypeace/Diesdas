<!DOCTYPE html>
<html>
<head>
    <title>Orb Miner - Deep Earth Adventure</title>
    <style>
        body {
            margin: 0;
            background: linear-gradient(180deg, #001122 0%, #332211 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: monospace;
            color: white;
        }
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        canvas {
            border: 2px solid #888;
            box-shadow: 0 0 25px rgba(255,200,0,0.3);
            border-radius: 5px;
        }
        #controls {
            text-align: center;
            color: #ccc;
            font-size: 12px;
            max-width: 500px;
        }
        #info {
            text-align: center;
            color: #ffcc00;
            font-size: 16px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="info">⛏️ Orb Miner - Deep Earth Adventure ⛏️</div>
        <canvas id="gameCanvas" width="320" height="240" style="width: 640px; height: 480px; image-rendering: pixelated;"></canvas>
        <div id="controls">
            WASD/Pfeiltasten: Bewegen | Leertaste: Spitzhacke | E: Trank verwenden<br>
            Grabe tiefer, sammle Edelsteine und Erze! Verbessere deine Ausrüstung!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const TILE_SIZE = 8;
        const MAP_WIDTH = 40;
        const MAP_HEIGHT = 60;
        
        // Game state
        let gameState = {
            camera: { x: 0, y: 0 },
            player: { 
                x: 160, 
                y: 20, 
                health: 100,
                maxHealth: 100,
                oxygen: 100,
                maxOxygen: 100,
                pickaxePower: 1,
                light: 50
            },
            inventory: {
                gems: 0,
                coal: 0,
                iron: 0,
                gold: 0,
                diamond: 0,
                healthPotions: 3,
                oxygenTanks: 2
            },
            world: {
                dirt: [],
                ores: [],
                hazards: [],
                depth: 0
            },
            particles: [],
            frame: 0,
            gameTime: 0,
            lastPickaxe: 0,
            shopOpen: false,
            messages: []
        };
        
        const keys = {};
        const MATERIALS = {
            DIRT: { color: '#8B4513', hardness: 1, value: 0 },
            STONE: { color: '#696969', hardness: 2, value: 0 },
            COAL: { color: '#2F2F2F', hardness: 2, value: 5 },
            IRON: { color: '#B87333', hardness: 3, value: 15 },
            GOLD: { color: '#FFD700', hardness: 4, value: 50 },
            DIAMOND: { color: '#87CEEB', hardness: 5, value: 200 },
            BEDROCK: { color: '#1C1C1C', hardness: 999, value: 0 }
        };
        
        // Input handling
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            // Use pickaxe
            if (e.code === 'Space') {
                usePickaxe();
            }
            
            // Use health potion
            if (e.code === 'KeyE') {
                useHealthPotion();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // Particle system
        class Particle {
            constructor(x, y, color, vx = 0, vy = 0, life = 60, size = 2) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.vx = vx;
                this.vy = vy;
                this.life = life;
                this.maxLife = life;
                this.size = size;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
                this.vy += 0.1; // gravity
                this.vx *= 0.98; // friction
            }
            
            draw() {
                const alpha = this.life / this.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - gameState.camera.x, this.y - gameState.camera.y, this.size, this.size);
                ctx.globalAlpha = 1;
            }
        }
        
        function addParticles(x, y, color, count = 5) {
            for (let i = 0; i < count; i++) {
                const vx = (Math.random() - 0.5) * 4;
                const vy = (Math.random() - 0.5) * 4 - 1;
                const size = Math.random() * 3 + 1;
                gameState.particles.push(new Particle(x, y, color, vx, vy, 30 + Math.random() * 30, size));
            }
        }
        
        function addMessage(text, color = '#ffffff', duration = 180) {
            gameState.messages.push({
                text: text,
                color: color,
                life: duration,
                y: 50 + gameState.messages.length * 15
            });
        }
        
        function generateWorld() {
            gameState.world.dirt = [];
            gameState.world.ores = [];
            
            for (let y = 0; y < MAP_HEIGHT; y++) {
                for (let x = 0; x < MAP_WIDTH; x++) {
                    const worldX = x * TILE_SIZE;
                    const worldY = y * TILE_SIZE;
                    const depth = y;
                    
                    // Surface area - no dirt for first few rows
                    if (y < 3) continue;
                    
                    // Bedrock at bottom
                    if (y >= MAP_HEIGHT - 2) {
                        gameState.world.dirt.push({
                            x: worldX,
                            y: worldY,
                            material: 'BEDROCK',
                            hardness: 999
                        });
                        continue;
                    }
                    
                    let material = 'DIRT';
                    let oreChance = Math.random();
                    
                    // Determine material based on depth
                    if (depth > 5 && Math.random() < 0.3) {
                        material = 'STONE';
                    }
                    
                    // Ore generation based on depth
                    if (depth > 8 && oreChance < 0.02) {
                        material = 'COAL';
                    } else if (depth > 15 && oreChance < 0.015) {
                        material = 'IRON';
                    } else if (depth > 25 && oreChance < 0.008) {
                        material = 'GOLD';
                    } else if (depth > 40 && oreChance < 0.003) {
                        material = 'DIAMOND';
                    }
                    
                    gameState.world.dirt.push({
                        x: worldX,
                        y: worldY,
                        material: material,
                        hardness: MATERIALS[material].hardness
                    });
                }
            }
            
            // Add some surface structures
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * (MAP_WIDTH * TILE_SIZE - 50) + 25;
                addParticles(x, 20, '#00ff00', 3);
            }
        }
        
        function updatePlayer() {
            const player = gameState.player;
            const speed = 2;
            
            // Movement
            let moved = false;
            if (keys['KeyA'] || keys['ArrowLeft']) {
                player.x -= speed;
                moved = true;
            }
            if (keys['KeyD'] || keys['ArrowRight']) {
                player.x += speed;
                moved = true;
            }
            if (keys['KeyW'] || keys['ArrowUp']) {
                player.y -= speed;
                moved = true;
            }
            if (keys['KeyS'] || keys['ArrowDown']) {
                player.y += speed;
                moved = true;
            }
            
            // Boundary checking
            player.x = Math.max(10, Math.min(MAP_WIDTH * TILE_SIZE - 10, player.x));
            player.y = Math.max(10, Math.min(MAP_HEIGHT * TILE_SIZE - 10, player.y));
            
            // Update depth
            gameState.world.depth = Math.floor(Math.max(0, player.y - 50) / TILE_SIZE);
            
            // Oxygen consumption underground
            if (gameState.world.depth > 5) {
                if (gameState.frame % 120 === 0) { // Every 2 seconds
                    player.oxygen = Math.max(0, player.oxygen - 1);
                    if (player.oxygen === 0 && gameState.frame % 60 === 0) {
                        player.health = Math.max(0, player.health - 5);
                        addMessage("Sauerstoff wird knapp!", '#ff4444');
                    }
                }
            } else {
                // Regenerate oxygen at surface
                player.oxygen = Math.min(player.maxOxygen, player.oxygen + 0.5);
            }
            
            // Health regeneration at surface
            if (gameState.world.depth === 0 && gameState.frame % 300 === 0) {
                player.health = Math.min(player.maxHealth, player.health + 1);
            }
            
            // Update camera to follow player
            gameState.camera.x = player.x - 160;
            gameState.camera.y = player.y - 120;
            
            // Camera bounds
            gameState.camera.x = Math.max(0, Math.min(MAP_WIDTH * TILE_SIZE - 320, gameState.camera.x));
            gameState.camera.y = Math.max(0, Math.min(MAP_HEIGHT * TILE_SIZE - 240, gameState.camera.y));
        }
        
        function usePickaxe() {
            if (Date.now() - gameState.lastPickaxe < 300) return; // Cooldown
            gameState.lastPickaxe = Date.now();
            
            const player = gameState.player;
            const range = 15;
            
            // Find nearby dirt blocks
            const nearbyBlocks = gameState.world.dirt.filter(block => {
                const dx = Math.abs(block.x + TILE_SIZE/2 - player.x);
                const dy = Math.abs(block.y + TILE_SIZE/2 - player.y);
                return dx < range && dy < range;
            });
            
            if (nearbyBlocks.length > 0) {
                const block = nearbyBlocks[0];
                const material = MATERIALS[block.material];
                
                if (material.hardness <= player.pickaxePower) {
                    // Successfully mined!
                    addParticles(block.x + TILE_SIZE/2, block.y + TILE_SIZE/2, material.color, 6);
                    
                    // Add to inventory
                    if (block.material === 'COAL') {
                        gameState.inventory.coal++;
                        addMessage("Kohle gefunden! (+5 Münzen)", '#666666');
                    } else if (block.material === 'IRON') {
                        gameState.inventory.iron++;
                        addMessage("Eisen gefunden! (+15 Münzen)", '#B87333');
                    } else if (block.material === 'GOLD') {
                        gameState.inventory.gold++;
                        addMessage("Gold gefunden! (+50 Münzen)", '#FFD700');
                    } else if (block.material === 'DIAMOND') {
                        gameState.inventory.diamond++;
                        addMessage("Diamant gefunden! (+200 Münzen)", '#87CEEB');
                    }
                    
                    // Remove block
                    gameState.world.dirt = gameState.world.dirt.filter(b => b !== block);
                } else {
                    // Block too hard
                    addParticles(block.x + TILE_SIZE/2, block.y + TILE_SIZE/2, '#ff0000', 3);
                    addMessage("Spitzhacke zu schwach!", '#ff4444');
                }
            } else {
                // Swing in air
                addParticles(player.x, player.y, '#ffffff', 3);
            }
        }
        
        function useHealthPotion() {
            if (gameState.inventory.healthPotions > 0 && gameState.player.health < gameState.player.maxHealth) {
                gameState.inventory.healthPotions--;
                gameState.player.health = Math.min(gameState.player.maxHealth, gameState.player.health + 50);
                addMessage("Heiltrank verwendet! (+50 Gesundheit)", '#00ff00');
                addParticles(gameState.player.x, gameState.player.y, '#00ff00', 8);
            }
        }
        
        function drawWorld() {
            const camX = gameState.camera.x;
            const camY = gameState.camera.y;
            
            // Sky/underground background
            if (gameState.world.depth === 0) {
                // Sky gradient
                const gradient = ctx.createLinearGradient(0, 0, 0, 240);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#8B4513');
                ctx.fillStyle = gradient;
            } else {
                // Underground
                const darkness = Math.min(0.8, gameState.world.depth * 0.02);
                ctx.fillStyle = `rgb(${Math.floor(68*(1-darkness))}, ${Math.floor(34*(1-darkness))}, ${Math.floor(17*(1-darkness))})`;
            }
            ctx.fillRect(0, 0, 320, 240);
            
            // Draw dirt blocks
            gameState.world.dirt.forEach(block => {
                const screenX = block.x - camX;
                const screenY = block.y - camY;
                
                // Only draw visible blocks
                if (screenX > -TILE_SIZE && screenX < 320 && screenY > -TILE_SIZE && screenY < 240) {
                    const material = MATERIALS[block.material];
                    ctx.fillStyle = material.color;
                    ctx.fillRect(screenX, screenY, TILE_SIZE - 1, TILE_SIZE - 1);
                    
                    // Add some texture
                    if (block.material !== 'BEDROCK') {
                        ctx.fillStyle = 'rgba(255,255,255,0.1)';
                        ctx.fillRect(screenX + 1, screenY + 1, 2, 2);
                    }
                }
            });
            
            // Draw surface grass
            if (camY < 50) {
                ctx.fillStyle = '#228B22';
                for (let x = 0; x < 320; x += 20) {
                    const grassX = x + (camX % 20);
                    if (20 - camY > 0) {
                        ctx.fillRect(grassX, 20 - camY, 15, 4);
                    }
                }
            }
        }
        
        function drawPlayer() {
            const player = gameState.player;
            const screenX = player.x - gameState.camera.x;
            const screenY = player.y - gameState.camera.y;
            
            // Player body
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(screenX - 4, screenY - 4, 8, 8);
            
            // Player helmet/light
            ctx.fillStyle = '#ffff00';
            ctx.fillRect(screenX - 5, screenY - 6, 10, 4);
            
            // Light circle underground
            if (gameState.world.depth > 3) {
                ctx.globalAlpha = 0.3;
                const gradient = ctx.createRadialGradient(screenX, screenY, 0, screenX, screenY, player.light);
                gradient.addColorStop(0, 'rgba(255,255,0,0.5)');
                gradient.addColorStop(1, 'rgba(255,255,0,0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(screenX, screenY, player.light, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
            
            // Pickaxe swing animation
            if (Date.now() - gameState.lastPickaxe < 150) {
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(screenX + 6, screenY);
                ctx.lineTo(screenX + 12, screenY - 8);
                ctx.stroke();
            }
        }
        
        function drawUI() {
            // UI Background
            ctx.fillStyle = 'rgba(0,0,0,0.8)';
            ctx.fillRect(0, 0, 320, 40);
            ctx.fillRect(0, 200, 320, 40);
            
            // Health bar
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(10, 10, 100, 8);
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(10, 10, gameState.player.health, 8);
            
            // Oxygen bar
            ctx.fillStyle = '#0000ff';
            ctx.fillRect(10, 22, 100, 8);
            ctx.fillStyle = '#00ffff';
            ctx.fillRect(10, 22, gameState.player.oxygen, 8);
            
            // Depth
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px monospace';
            ctx.fillText(`Tiefe: ${gameState.world.depth}m`, 130, 15);
            ctx.fillText(`HP: ${gameState.player.health}`, 130, 25);
            ctx.fillText(`O2: ${gameState.player.oxygen}`, 130, 35);
            
            // Inventory
            ctx.fillText('Inventar:', 10, 215);
            ctx.fillText(`Kohle: ${gameState.inventory.coal}`, 10, 225);
            ctx.fillText(`Eisen: ${gameState.inventory.iron}`, 80, 225);
            ctx.fillText(`Gold: ${gameState.inventory.gold}`, 150, 225);
            ctx.fillText(`Diamant: ${gameState.inventory.diamond}`, 200, 225);
            ctx.fillText(`Tränke: ${gameState.inventory.healthPotions}`, 280, 225);
            
            // Total value
            const totalValue = gameState.inventory.coal * 5 + 
                              gameState.inventory.iron * 15 + 
                              gameState.inventory.gold * 50 + 
                              gameState.inventory.diamond * 200;
            ctx.fillText(`Wert: ${totalValue} Münzen`, 10, 235);
        }
        
        function drawMessages() {
            gameState.messages = gameState.messages.filter(msg => {
                msg.life--;
                msg.y -= 0.2;
                
                ctx.fillStyle = msg.color;
                ctx.globalAlpha = Math.min(1, msg.life / 60);
                ctx.font = '8px monospace';
                ctx.fillText(msg.text, 10, msg.y);
                ctx.globalAlpha = 1;
                
                return msg.life > 0;
            });
        }
        
        function update() {
            gameState.frame++;
            gameState.gameTime++;
            
            updatePlayer();
            
            // Update particles
            gameState.particles = gameState.particles.filter(particle => {
                particle.update();
                return particle.life > 0;
            });
            
            // Check game over
            if (gameState.player.health <= 0) {
                addMessage("Du bist gestorben! Die Mine hat dich besiegt...", '#ff0000', 300);
            }
        }
        
        function draw() {
            drawWorld();
            
            // Draw particles
            gameState.particles.forEach(particle => particle.draw());
            
            drawPlayer();
            drawUI();
            drawMessages();
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        function initGame() {
            generateWorld();
            gameState.player.x = 160;
            gameState.player.y = 20;
            addMessage("Willkommen in der Mine! Grabe tief und sammle Schätze!", '#ffff00');
        }
        
        // Initialize and start game
        initGame();
        gameLoop();
    </script>
</body>
</html>
